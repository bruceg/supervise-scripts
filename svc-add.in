#!/bin/sh
if [ "$1" = -d ]; then
  down=true
  shift
else
  down=false
fi

usage $# 1 2 "[-d] service [svc-directory]"

svc="$1"
if [ "X$2" = X ]; then
  svcdir="${SVCLOCKDIR-/var/service}/$svc"
else
  svcdir="$2"
fi

if [ -e "$svc" ]; then
  fatal "Service '$svc' is already set up."
fi

if ! [ -d "$svcdir" ]; then
  fatal "'$svcdir' is not a directory."
fi

if $down; then
  touch "$svcdir"/down
fi

if [ -d "$svcdir"/log ]; then
  chmod +t "$svcdir"
  if $down; then
    touch "$svcdir"/log/down
  fi
else
  chmod -t "$svcdir"
fi

ln -s "$svcdir" "svc"
